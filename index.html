<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EssentialSuds | Handcrafted Organic Soap</title>
    
    <!-- Tailwind CSS (via CDN for standalone functionality) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Montserrat for headings, Open Sans for body -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- STRIPE PAYMENT SDK (Crucial for Security) -->
    <script src="https://js.stripe.com/v3/"></script>

    <!-- Custom Config for Tailwind Colors/Fonts -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            black: '#2c2725', // Softer black/brown for soap aesthetic
                            gold: '#d4a373',  // Warm earthy gold
                            cream: '#fefae0',
                            sage: '#ccd5ae',
                            light: '#faf9f6'
                        }
                    },
                    fontFamily: {
                        sans: ['Open Sans', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Utilities */
        body { font-family: 'Open Sans', sans-serif; -webkit-font-smoothing: antialiased; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Montserrat', sans-serif; }
        
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scrollbar hiding for clean UI */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Slow spin for the logo burst */
        .spin-slow { animation: spin 20s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Floating Animation for Ingredients */
        .float-anim { animation: float 6s ease-in-out infinite; }
        .float-anim-delay-1 { animation-delay: 1s; }
        .float-anim-delay-2 { animation-delay: 2s; }
        .float-anim-delay-3 { animation-delay: 3s; }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        .ingredient-card:hover {
            transform: scale(1.15) rotate(5deg);
            z-index: 50;
        }

        /* --- NEW INTERACTIVE STYLES --- */
        
        /* Soap Bubble Cursor Trail */
        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.4) 60%, rgba(255, 255, 255, 0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: float-up 1.5s ease-out forwards;
            z-index: 9999;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
        }

        @keyframes float-up {
            0% { transform: translateY(0) scale(0.5); opacity: 0.8; }
            50% { opacity: 0.6; }
            100% { transform: translateY(-80px) scale(1.2); opacity: 0; }
        }

        /* Ingredient Confetti Particle */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-burst 0.8s ease-out forwards;
            z-index: 40;
        }
        @keyframes particle-burst {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Pop Animation for Info Box */
        .pop-in {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Scroll Reveal Effect */
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: all 1s cubic-bezier(0.5, 0, 0, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Button Ripple Effect */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-anim 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple-anim {
            to { transform: scale(4); opacity: 0; }
        }
        
        /* Cart Bump Animation */
        @keyframes bump {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .bump {
            animation: bump 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-brand-light text-brand-black overflow-x-hidden cursor-default">

    <!-- NAVIGATION -->
    <nav class="fixed w-full z-50 bg-white/95 backdrop-blur-md border-b border-gray-100 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo (Text for Nav) -->
                <div class="flex-shrink-0 flex items-center cursor-pointer group" onclick="app.navigate('home')">
                    <span class="font-heading font-bold text-2xl tracking-widest text-brand-black group-hover:text-brand-gold transition-colors">ESSENTIALSUDS</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#" onclick="event.preventDefault(); app.scrollToSection('products')" class="text-sm font-medium hover:text-brand-gold transition-colors uppercase tracking-wide relative group">
                        The Shop
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); app.scrollToSection('ingredients')" class="text-sm font-medium hover:text-brand-gold transition-colors uppercase tracking-wide relative group">
                        Ingredients
                         <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); app.scrollToSection('about')" class="text-sm font-medium hover:text-brand-gold transition-colors uppercase tracking-wide relative group">
                        Our Story
                         <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </div>

                <!-- Icons -->
                <div class="flex items-center space-x-6">
                    <button id="cart-btn" class="relative text-brand-black hover:text-brand-gold transition-colors transform hover:scale-110 duration-200" onclick="app.toggleCart()">
                        <i class="fa-solid fa-bag-shopping text-xl"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-brand-gold text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center opacity-0 transition-opacity duration-300">0</span>
                    </button>
                    <!-- Mobile Menu Button -->
                    <button class="md:hidden text-brand-black text-xl" onclick="app.toggleMobileMenu()">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-gray-100">
            <div class="px-4 pt-2 pb-6 space-y-2">
                <a href="#" onclick="event.preventDefault(); app.scrollToSection('products'); app.toggleMobileMenu()" class="block py-2 text-base font-medium text-gray-800">The Shop</a>
                <a href="#" onclick="event.preventDefault(); app.scrollToSection('ingredients'); app.toggleMobileMenu()" class="block py-2 text-base font-medium text-gray-800">Ingredients</a>
                <a href="#" onclick="event.preventDefault(); app.scrollToSection('about'); app.toggleMobileMenu()" class="block py-2 text-base font-medium text-gray-800">Our Story</a>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT CONTAINER -->
    <main id="main-content" class="pt-20">
        <!-- Rendered via JS -->
    </main>

    <!-- CART DRAWER -->
    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity duration-300 opacity-0" onclick="app.toggleCart()"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white z-[70] transform translate-x-full transition-transform duration-300 shadow-2xl flex flex-col">
        <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h2 class="text-xl font-heading font-semibold">Your Basket</h2>
            <button onclick="app.toggleCart()" class="text-gray-400 hover:text-brand-black transform hover:rotate-90 transition-transform duration-300">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6">
            <!-- Cart items injected here -->
        </div>

        <div class="p-6 border-t border-gray-100 bg-gray-50">
            <div class="flex justify-between mb-4 text-lg font-bold">
                <span>Subtotal</span>
                <span id="cart-total">$0.00</span>
            </div>
            <p class="text-xs text-gray-500 mb-4 text-center">
                <i class="fa-solid fa-lock text-brand-gold mr-1"></i> Payments secured by Stripe
            </p>
            <!-- UPDATED CHECKOUT BUTTON -->
            <button id="checkout-btn" onclick="app.createRipple(event); app.processCheckout()" class="btn-ripple w-full bg-brand-black text-white py-4 font-bold tracking-widest hover:bg-brand-gold transition-colors duration-300 flex items-center justify-center gap-2">
                <span>CHECKOUT</span>
            </button>
        </div>
    </div>

    <!-- PRODUCT DETAIL MODAL -->
    <div id="product-modal" class="fixed inset-0 z-[80] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="app.closeModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-white shadow-2xl rounded-sm sm:rounded-lg animate-fade-in">
            <button onclick="app.closeModal()" class="absolute top-4 right-4 z-10 bg-white rounded-full p-2 shadow hover:bg-gray-100 transition-transform hover:rotate-90">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <div id="modal-content" class="flex flex-col md:flex-row">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-brand-black text-white pt-16 pb-8 reveal">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-12 border-b border-gray-700 pb-12">
            <div>
                <h3 class="font-heading font-bold text-2xl tracking-widest mb-6">ESSENTIALSUDS</h3>
                <p class="text-gray-300 text-sm leading-relaxed">
                    Handcrafted organic soap made with the finest essential oils and botanicals. Pure, sustainable, and luxurious.
                </p>
                <div class="flex space-x-4 mt-6">
                    <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-transform"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-transform"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-transform"><i class="fa-brands fa-tiktok"></i></a>
                </div>
            </div>
            <div>
                <h4 class="font-bold text-sm uppercase tracking-wider mb-6">Shop</h4>
                <ul class="space-y-3 text-sm text-gray-400">
                    <li><a href="#" onclick="app.scrollToSection('products')" class="hover:text-brand-gold transition-colors">Our Signature Bar</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold text-sm uppercase tracking-wider mb-6">Support</h4>
                <ul class="space-y-3 text-sm text-gray-400">
                    <li><a href="#" onclick="event.preventDefault(); app.openInfoModal('ingredients')" class="hover:text-brand-gold transition-colors">Ingredients List</a></li>
                    <li><a href="#" onclick="event.preventDefault(); app.openInfoModal('sustainability')" class="hover:text-brand-gold transition-colors">Sustainability</a></li>
                    <li><a href="#" onclick="event.preventDefault(); app.openInfoModal('shipping')" class="hover:text-brand-gold transition-colors">Shipping & Returns</a></li>
                    <li><a href="#" onclick="event.preventDefault(); app.openInfoModal('contact')" class="hover:text-brand-gold transition-colors">Contact Us</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold text-sm uppercase tracking-wider mb-6">Stay Connected</h4>
                <p class="text-gray-400 text-sm mb-4">Subscribe for release updates.</p>
                <div class="flex border-b border-gray-600 pb-2">
                    <input type="email" placeholder="Email Address" class="bg-transparent border-none outline-none text-white w-full placeholder-gray-500 focus:placeholder-white transition-all">
                    <button class="text-brand-gold font-bold uppercase text-xs hover:text-white transition-colors">Join</button>
                </div>
            </div>
        </div>
        <div class="text-center pt-8 text-gray-500 text-xs">
            &copy; 2025 EssentialSuds. All rights reserved.
        </div>
    </footer>

    <!-- JAVASCRIPT APPLICATION LOGIC -->
    <script>
        // --- IMAGE ERROR HANDLER (Smart Loader) ---
        // This function tries to fix the "double extension" issue (toy.jpg.jpg or toy.png.png) automatically
        window.handleImageError = function(img) {
            // Check if we already tried to fix it
            if (img.dataset.triedFix === "true") {
                // If the fix failed, load the generic placeholder from the web
                img.onerror = null; 
                img.src = "https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=800&auto=format&fit=crop";
                return;
            }

            // Mark that we are trying to fix it
            img.dataset.triedFix = "true";

            // If the current source ends in .jpg or .png, try adding the extension again (the double extension issue)
            if (img.src.endsWith('.jpg')) {
                img.src = img.src + ".jpg";
            } else if (img.src.endsWith('.png')) {
                img.src = img.src + ".png";
            } else {
                // Otherwise just load the placeholder
                img.src = "https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=800&auto=format&fit=crop";
            }
        };

        const app = (() => {
            // --- STATE ---
            const state = {
                // EXPANDED PRODUCT LIST
                products: [
                    {
                        id: 1,
                        name: "Texas Honey & Vanilla Oat",
                        category: "bar",
                        price: 12.00,
                        stripePriceId: "price_123456789", 
                        image: "https://images.unsplash.com/photo-1600857544200-b2f666a9a2ec?q=80&w=800&auto=format&fit=crop",
                        // ADDED: Gallery images for Product 1 (Updated to Object format)
                        images: [
                            { src: "https://images.unsplash.com/photo-1600857544200-b2f666a9a2ec?q=80&w=800&auto=format&fit=crop", title: "Signature Bar" },
                            { src: "https://images.unsplash.com/photo-1570194065650-d99fb4b8ccb0?q=80&w=800&auto=format&fit=crop", title: "Rich Lather" },
                            { src: "https://images.unsplash.com/photo-1607006411601-776c8cc37d7b?q=80&w=800&auto=format&fit=crop", title: "Natural Texture" }
                        ],
                        shortDesc: "Local Texas honey and sweet almond oil blended with exfoliating rolled oats.",
                        weight: "5 oz",
                        skinType: "All Types / Dry",
                        scent: "Warm / Sweet",
                        ingredients: ["Colloidal Oats", "Texas Honey", "Sweet Almond Oil", "Vanilla Oil", "Rolled Oats"],
                        rating: 5.0
                    },
                    {
                        id: 2,
                        name: "Organic Animal Soap w/ Toy",
                        category: "kids",
                        price: 14.50,
                        stripePriceId: "price_animal_toy", 
                        image: "toy.png", 
                        // ADDED: Gallery images with specific Animal Descriptions
                        images: [
                            { src: "toy.png", title: "The Surprise Box", desc: "Handcrafted organic soap with a hidden animal toy surprise inside. Gentle, safe, and fun." },
                            { src: "toy1.png", title: "Brave Lion", desc: "Rule the bath time jungle with the King of Beasts! This bar reveals a courageous Lion toy." },
                            { src: "toy2.png", title: "Cuddly Bear", desc: "Unbearably cute! A cozy Bear toy makes washing hands a fuzzy, warm delight." },
                            { src: "toy3.png", title: "Happy Hippo", desc: "Splish, splash, and smile! Find a cheerful Hippo friend hiding in the bubbles." },
                            { src: "toy4.png", title: "Gentle Elephant", desc: "Stomp into sudsy fun! A wise and gentle Elephant is waiting to be discovered." }
                        ],
                        shortDesc: "Handcrafted organic soap with a hidden animal toy surprise inside. Gentle, safe, and fun.",
                        weight: "4.5 oz",
                        skinType: "Sensitive / Kids",
                        scent: "Unscented / Mild Chamomile",
                        ingredients: ["Organic Glycerin", "Coconut Oil", "Shea Butter", "Chamomile Extract", "Toy Inside"],
                        rating: 4.9
                    },
                    {
                        id: 3,
                        name: "Citrus Orange Antibacterial Body Bar",
                        category: "bar",
                        price: 13.00,
                        stripePriceId: "price_citrus_bar",
                        image: "citrus.jpg",
                        // NEW CITRUS PRODUCT GALLERY (WITH YOUR 4 NEW PNGs)
                        images: [
                            { src: "citrus.jpg", title: "Fresh Citrus Bar", desc: "Three bars of bright orange-yellow handmade soap wrapped in clear plastic. Packed with real orange zest and essential oils." },
                            { src: "citrus1.png", title: "Zesty Details", desc: "A close-up of the bright yellow and orange layers, showing the handmade texture and vibrant color." },
                            { src: "citrus2.png", title: "Fresh Ingredients", desc: "Showcasing the real lemons and oranges we use to create that authentic, uplifting scent." },
                            { src: "citrus3.png", title: "Healing Power", desc: "Rich with Vitamin C and natural antibacterial properties to keep skin healthy and clean." },
                            { src: "citrus4.png", title: "Gift Ready", desc: "Beautifully presented in a natural crate with crinkle paperâ€”perfect for gifting or treating yourself." }
                        ],
                        shortDesc: "Sunshine in a Box. Packed with real orange zest and essential oils to fight bacteria.",
                        weight: "100g (3.5 oz)",
                        skinType: "All Types / Healing",
                        scent: "Orange, Lemon & Bergamot",
                        ingredients: ["Shea Butter", "Olive Oil", "Orange Zest", "Lemon Oil", "Bergamot Oil"],
                        rating: 4.8
                    }
                ],
                cart: [],
                activeCategory: 'all',
                ingredients: {
                    'honey': {
                        title: "Local Texas Honey",
                        desc: "A natural humectant that draws moisture to the skin. Packed with antioxidants, it helps repair skin barriers and gives a natural, warm glow.",
                        icon: "fa-jar",
                        color: "text-amber-500",
                        bgColor: "bg-amber-100",
                        particleColor: "#f59e0b"
                    },
                    'oats': {
                        title: "Colloidal Oats",
                        desc: "Finely ground oats that soothe itchiness and calm inflammation. Perfect for sensitive skin or eczema-prone areas.",
                        icon: "fa-wheat-awn",
                        color: "text-brand-sage",
                        bgColor: "bg-[#e8f0d8]",
                        particleColor: "#ccd5ae"
                    },
                    'almond': {
                        title: "Sweet Almond Oil",
                        desc: "Rich in Vitamin E and A, this lightweight oil penetrates deeply to soften skin without clogging pores. Improves complexion and skin tone.",
                        icon: "fa-droplet",
                        color: "text-yellow-600",
                        bgColor: "bg-yellow-100",
                        particleColor: "#ca8a04"
                    },
                    'vanilla': {
                        title: "Vanilla Essential Oil",
                        desc: "Beyond its comforting aroma, vanilla is rich in antioxidants that help reverse skin damage and soothe inflammation.",
                        icon: "fa-spa",
                        color: "text-brand-black",
                        bgColor: "bg-gray-200",
                        particleColor: "#2c2725"
                    },
                    'rolled': {
                        title: "Rolled Oats",
                        desc: "Whole oats provide gentle, natural exfoliation to buff away dead skin cells, revealing softer, smoother skin underneath.",
                        icon: "fa-bowl-rice",
                        color: "text-stone-600",
                        bgColor: "bg-stone-200",
                        particleColor: "#78716c"
                    }
                }
            };

            // --- INTERACTIVITY FUNCTIONS ---
            
            const initCursorBubbles = () => {
                let lastTime = 0;
                document.addEventListener('mousemove', (e) => {
                    const now = Date.now();
                    if (now - lastTime < 100) return; 
                    lastTime = now;

                    const bubble = document.createElement('div');
                    bubble.classList.add('bubble');
                    const size = Math.random() * 15 + 5; 
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${e.pageX}px`;
                    bubble.style.top = `${e.pageY}px`;
                    
                    document.body.appendChild(bubble);

                    setTimeout(() => {
                        bubble.remove();
                    }, 1500);
                });
            };

            const initScrollReveal = () => {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('active');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.15, rootMargin: "0px 0px -50px 0px" });

                document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
            };

            const initIngredientParallax = () => {
                const container = document.getElementById('ingredients-container');
                if (!container) return;

                container.addEventListener('mousemove', (e) => {
                    const rect = container.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / rect.width - 0.5;
                    const y = (e.clientY - rect.top) / rect.height - 0.5;

                    const icons = container.querySelectorAll('.ingredient-card');
                    icons.forEach((icon, index) => {
                        const depth = (index + 1) * 15; // Varying depth
                        const moveX = x * depth;
                        const moveY = y * depth;
                        icon.style.transform = `translate(${moveX}px, ${moveY}px) scale(1.05)`;
                    });
                });
                
                container.addEventListener('mouseleave', () => {
                     const icons = container.querySelectorAll('.ingredient-card');
                     icons.forEach(icon => {
                         icon.style.transform = ''; // Reset to CSS animation
                     });
                });
            };

            // --- RENDER FUNCTIONS ---
            
            const renderHero = () => {
                return `
                    <section class="relative h-[85vh] flex items-center justify-center overflow-hidden bg-gradient-to-br from-brand-light via-[#f5f0e6] to-[#e8e4d9]">
                        <div class="absolute top-0 right-0 w-1/2 h-full opacity-5 pointer-events-none">
                             <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full spin-slow">
                                <path fill="#2c2725" d="M44.7,-76.4C58.9,-69.2,71.8,-59.1,81.6,-46.6C91.4,-34.1,98.2,-19.2,95.8,-4.2C93.5,10.8,82,25.9,71,38.8C60,51.7,49.5,62.4,37.3,69.6C25.1,76.8,11.3,80.5,-1.9,83.8C-15.1,87.1,-28.8,90,-40.8,83.9C-52.8,77.8,-63.1,62.7,-71.3,47.8C-79.5,32.9,-85.6,18.2,-85.3,3.7C-85,-10.8,-78.3,-25.1,-69,-37.8C-59.7,-50.5,-47.8,-61.6,-34.7,-69.4C-21.6,-77.2,-7.3,-81.7,5.4,-91.1L10.8,-100.5" transform="translate(100 100)" />
                             </svg>
                        </div>

                        <div class="relative z-10 max-w-7xl w-full px-6 flex flex-col items-center justify-center h-full text-center">
                            <div class="mb-10 transform hover:scale-105 transition-transform duration-700 animate-fade-in cursor-pointer">
                                <svg width="280" height="280" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-2xl">
                                    <circle cx="150" cy="150" r="140" fill="none" stroke="#d4a373" stroke-width="2"/>
                                    <circle cx="150" cy="150" r="130" fill="#fefae0" stroke="none"/>
                                    <path d="M150 40 Q170 80 150 110 Q130 80 150 40" fill="#ccd5ae" opacity="0.8"/>
                                    <path d="M150 40 Q180 60 190 90" fill="none" stroke="#ccd5ae" stroke-width="2"/>
                                    <path d="M150 40 Q120 60 110 90" fill="none" stroke="#ccd5ae" stroke-width="2"/>
                                    <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="Montserrat, sans-serif" font-weight="700" font-size="32" fill="#2c2725" letter-spacing="2">ESSENTIAL</text>
                                    <text x="50%" y="68%" dominant-baseline="middle" text-anchor="middle" font-family="Montserrat, sans-serif" font-weight="400" font-size="24" fill="#d4a373" letter-spacing="8">SUDS</text>
                                    <path d="M150 260 Q130 220 150 190 Q170 220 150 260" fill="#ccd5ae" opacity="0.8"/>
                                </svg>
                            </div>
                            <div class="animate-fade-in mx-auto max-w-3xl">
                                <h1 class="text-4xl md:text-6xl font-heading font-bold mb-6 leading-tight text-brand-black">The Perfect Bar.</h1>
                                <p class="text-lg md:text-xl text-gray-600 mb-10 leading-relaxed font-light">
                                    One essential bar for a complete, luxurious cleanse. <br>Made with cold-pressed oils and pure botanicals.
                                </p>
                                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                    <button onclick="app.createRipple(event); app.scrollToSection('products')" class="btn-ripple bg-brand-black text-white px-10 py-4 font-bold tracking-widest hover:bg-brand-gold hover:text-white transition-all duration-300 shadow-xl rounded-sm">
                                        SHOP NOW
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                     <div class="bg-white py-10 border-b border-gray-100 reveal">
                        <div class="max-w-7xl mx-auto px-6 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                            <div class="flex flex-col items-center group cursor-default">
                                <i class="fa-solid fa-leaf text-3xl text-brand-gold mb-3 transform group-hover:scale-110 transition-transform"></i>
                                <h4 class="font-bold text-sm uppercase text-brand-black">100% Vegan</h4>
                                <p class="text-xs text-gray-500 mt-1">Plant-Based Ingredients</p>
                            </div>
                            <div class="flex flex-col items-center group cursor-default">
                                <i class="fa-solid fa-hand-holding-heart text-3xl text-brand-gold mb-3 transform group-hover:scale-110 transition-transform"></i>
                                <h4 class="font-bold text-sm uppercase text-brand-black">Handmade</h4>
                                <p class="text-xs text-gray-500 mt-1">Small Batches</p>
                            </div>
                            <div class="flex flex-col items-center group cursor-default">
                                <i class="fa-solid fa-ban text-3xl text-brand-gold mb-3 transform group-hover:scale-110 transition-transform"></i>
                                <h4 class="font-bold text-sm uppercase text-brand-black">Paraben Free</h4>
                                <p class="text-xs text-gray-500 mt-1">No Harsh Chemicals</p>
                            </div>
                            <div class="flex flex-col items-center group cursor-default">
                                <i class="fa-solid fa-recycle text-3xl text-brand-gold mb-3 transform group-hover:scale-110 transition-transform"></i>
                                <h4 class="font-bold text-sm uppercase text-brand-black">Eco-Friendly</h4>
                                <p class="text-xs text-gray-500 mt-1">Plastic-Free Packaging</p>
                            </div>
                        </div>
                    </div>
                `;
            };

            const renderProductsSection = () => {
                // MODIFIED: Now renders a grid of ALL products
                return `
                    <section id="products" class="py-20 bg-brand-light reveal">
                        <div class="max-w-7xl mx-auto px-6">
                            <div class="text-center max-w-3xl mx-auto mb-16">
                                <h2 class="text-3xl md:text-4xl font-heading font-bold mb-4">The Collection</h2>
                                <p class="text-gray-500">Simple, effective, and luxurious soaps for the whole family.</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 justify-items-center">
                                ${state.products.map(p => `
                                    <div class="max-w-sm w-full group bg-white rounded-lg overflow-hidden border border-gray-100 hover:border-gray-200 hover:shadow-xl transition-all duration-300 flex flex-col transform hover:-translate-y-2">
                                        <div class="relative overflow-hidden aspect-square cursor-pointer" onclick="app.openModal(${p.id})">
                                            <!-- UPDATED IMG TAG WITH SMART ERROR HANDLER -->
                                            <img src="${p.image}" alt="${p.name}" 
                                                class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700" 
                                                onerror="window.handleImageError(this)">
                                            
                                            <button onclick="event.stopPropagation(); app.createRipple(event); app.addToCart(${p.id})" class="btn-ripple absolute bottom-4 right-4 bg-brand-black text-white w-12 h-12 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all duration-300 hover:bg-brand-gold shadow-lg">
                                                <i class="fa-solid fa-plus text-lg"></i>
                                            </button>
                                        </div>
                                        <div class="p-6 flex-grow flex flex-col">
                                            <div class="flex justify-between items-start mb-2">
                                                <h3 class="font-heading font-bold text-lg text-brand-black group-hover:text-brand-gold transition-colors cursor-pointer" onclick="app.openModal(${p.id})">${p.name}</h3>
                                            </div>
                                            <p class="text-sm text-gray-500 mb-4 line-clamp-2">${p.shortDesc}</p>
                                            
                                            <div class="flex items-center gap-2 mb-4 text-xs text-gray-400">
                                                <span class="bg-brand-cream px-2 py-1 rounded text-brand-black font-medium">${p.skinType}</span>
                                                <span>${p.weight}</span>
                                            </div>

                                            <div class="mt-auto flex items-center justify-between">
                                                <span class="font-bold text-lg">$${p.price.toFixed(2)}</span>
                                                <div class="text-xs text-brand-gold">
                                                    <i class="fa-solid fa-star"></i> ${p.rating}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </section>
                `;
            };

            const renderTechSection = () => `
                <section id="ingredients" class="py-20 bg-white reveal">
                    <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center gap-16">
                        
                        <!-- INTERACTIVE INGREDIENTS CONTAINER -->
                        <div id="ingredients-container" class="w-full md:w-1/2 relative min-h-[450px] bg-brand-light rounded-xl p-8 flex items-center justify-center overflow-hidden border border-gray-100 shadow-inner group transition-colors duration-700">
                            <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] transition-opacity group-hover:opacity-20 pointer-events-none"></div>
                            
                            <!-- Central Info Box -->
                            <div id="ingredient-info" class="relative z-20 text-center max-w-xs transition-all duration-300 bg-white/90 backdrop-blur-md p-8 rounded-xl shadow-2xl border border-brand-cream scale-100">
                                <h4 class="font-heading font-bold text-xl mb-3 text-brand-black">Nature's Best</h4>
                                <p class="text-sm text-gray-600 leading-relaxed">Hover over the floating ingredients to discover their skin-loving benefits.</p>
                            </div>

                            <!-- Floating Icons -->
                            <div class="ingredient-card absolute top-12 left-10 md:left-20 bg-white p-5 rounded-full shadow-lg cursor-pointer transition-all duration-300 float-anim border-4 border-white"
                                 onmouseenter="app.showBenefit('honey', event)" onmouseleave="app.resetBenefit()">
                                <i class="fa-solid fa-jar text-3xl text-amber-500"></i>
                            </div>

                            <div class="ingredient-card absolute bottom-24 left-4 md:left-12 bg-white p-5 rounded-full shadow-lg cursor-pointer transition-all duration-300 float-anim float-anim-delay-1 border-4 border-white"
                                 onmouseenter="app.showBenefit('oats', event)" onmouseleave="app.resetBenefit()">
                                <i class="fa-solid fa-wheat-awn text-3xl text-brand-sage"></i>
                            </div>

                            <div class="ingredient-card absolute top-10 right-12 md:right-24 bg-white p-5 rounded-full shadow-lg cursor-pointer transition-all duration-300 float-anim float-anim-delay-2 border-4 border-white"
                                 onmouseenter="app.showBenefit('almond', event)" onmouseleave="app.resetBenefit()">
                                <i class="fa-solid fa-droplet text-3xl text-yellow-500"></i>
                            </div>

                            <div class="ingredient-card absolute bottom-16 right-8 md:right-16 bg-white p-5 rounded-full shadow-lg cursor-pointer transition-all duration-300 float-anim float-anim-delay-3 border-4 border-white"
                                 onmouseenter="app.showBenefit('vanilla', event)" onmouseleave="app.resetBenefit()">
                                <i class="fa-solid fa-spa text-3xl text-brand-black"></i>
                            </div>

                             <div class="ingredient-card absolute top-1/2 right-4 transform -translate-y-1/2 bg-white p-4 rounded-full shadow-lg cursor-pointer transition-all duration-300 float-anim float-anim-delay-1 border-4 border-white"
                                 onmouseenter="app.showBenefit('rolled', event)" onmouseleave="app.resetBenefit()">
                                <i class="fa-solid fa-bowl-rice text-2xl text-stone-500"></i>
                            </div>
                        </div>

                        <div class="w-full md:w-1/2">
                            <span class="text-brand-gold font-bold tracking-widest uppercase text-sm mb-2 block">The Cold Process Method</span>
                            <h2 class="text-3xl md:text-4xl font-heading font-bold mb-6">Why Cold Process?</h2>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                We use the traditional cold process method which preserves the therapeutic benefits of our plant-based oils and butters. Unlike commercial soaps, our bars retain their natural glycerin, leaving your skin soft and moisturized.
                            </p>
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-start transform hover:translate-x-2 transition-transform duration-300">
                                    <i class="fa-solid fa-check text-brand-gold mt-1 mr-3"></i>
                                    <div>
                                        <strong class="block text-brand-black">Natural Glycerin</strong>
                                        <span class="text-sm text-gray-500">A natural humectant that draws moisture to the skin.</span>
                                    </div>
                                </li>
                                <li class="flex items-start transform hover:translate-x-2 transition-transform duration-300">
                                    <i class="fa-solid fa-check text-brand-gold mt-1 mr-3"></i>
                                    <div>
                                        <strong class="block text-brand-black">Cured for 6 Weeks</strong>
                                        <span class="text-sm text-gray-500">Ensures a hard, long-lasting bar with rich lather.</span>
                                    </div>
                                </li>
                                <li class="flex items-start transform hover:translate-x-2 transition-transform duration-300">
                                    <i class="fa-solid fa-check text-brand-gold mt-1 mr-3"></i>
                                    <div>
                                        <strong class="block text-brand-black">Zero Detergents</strong>
                                        <span class="text-sm text-gray-500">No sulfates, phthalates, or synthetic hardeners.</span>
                                    </div>
                                </li>
                            </ul>
                            <a href="#products" onclick="event.preventDefault(); app.scrollToSection('products')" class="text-brand-black font-bold border-b-2 border-brand-black pb-1 hover:text-brand-gold hover:border-brand-gold transition-colors">Shop The Collection</a>
                        </div>
                    </div>
                </section>
            `;

            const renderAboutSection = () => `
                <section id="about" class="py-24 bg-brand-cream text-brand-black text-center relative overflow-hidden reveal">
                    <div class="max-w-4xl mx-auto px-6 relative z-10">
                        <i class="fa-solid fa-spa text-4xl text-brand-gold mb-6 animate-pulse"></i>
                        <h2 class="text-3xl md:text-5xl font-heading font-bold mb-8">Pure. Simple. Honest.</h2>
                        <p class="text-xl text-gray-600 mb-10 leading-relaxed font-light">
                            "We believe that what you put on your body is just as important as what you put in it. Our mission is to bring the spa experience to your daily routine with ingredients you can pronounce."
                        </p>
                    </div>
                </section>
            `;

            // --- LOGIC ---

            const updateCartUI = () => {
                const cartContainer = document.getElementById('cart-items');
                const cartTotal = document.getElementById('cart-total');
                const cartCountBadge = document.getElementById('cart-count');
                const cartBtn = document.getElementById('cart-btn');
                
                const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCountBadge.innerText = totalItems;
                cartCountBadge.classList.toggle('opacity-0', totalItems === 0);

                if (totalItems > 0) {
                    cartBtn.classList.remove('bump');
                    void cartBtn.offsetWidth; // trigger reflow
                    cartBtn.classList.add('bump');
                }

                if (state.cart.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="text-center text-gray-500 mt-10">
                            <i class="fa-solid fa-basket-shopping text-4xl mb-4 opacity-30"></i>
                            <p>Your basket is empty.</p>
                            <button onclick="app.toggleCart(); app.scrollToSection('products')" class="mt-4 text-brand-gold font-semibold hover:underline">Start Shopping</button>
                        </div>
                    `;
                    cartTotal.innerText = "$0.00";
                    return;
                }

                let total = 0;
                cartContainer.innerHTML = state.cart.map(item => {
                    const product = state.products.find(p => p.id === item.id);
                    total += product.price * item.quantity;
                    return `
                        <div class="flex gap-4 items-center animate-fade-in">
                            <div class="w-20 h-20 flex-shrink-0 bg-gray-100 rounded overflow-hidden">
                                <img src="${product.image}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-sm text-brand-black">${product.name}</h4>
                                <p class="text-xs text-gray-500 mb-2">$${product.price.toFixed(2)}</p>
                                <div class="flex items-center border border-gray-200 w-max rounded-full">
                                    <button onclick="app.updateQuantity(${item.id}, -1)" class="px-2 py-1 text-xs text-gray-500 hover:bg-gray-100 rounded-l-full"><i class="fa-solid fa-minus"></i></button>
                                    <span class="px-2 text-xs font-semibold">${item.quantity}</span>
                                    <button onclick="app.updateQuantity(${item.id}, 1)" class="px-2 py-1 text-xs text-gray-500 hover:bg-gray-100 rounded-r-full"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                            <button onclick="app.removeFromCart(${item.id})" class="text-gray-300 hover:text-red-500 transition-colors">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                    `;
                }).join('');

                cartTotal.innerText = "$" + total.toFixed(2);
            };

            // --- PUBLIC API ---
            return {
                init: () => {
                    const main = document.getElementById('main-content');
                    main.innerHTML = renderHero() + renderProductsSection() + renderTechSection() + renderAboutSection();
                    
                    initCursorBubbles();
                    initScrollReveal();
                    initIngredientParallax();
                },

                createRipple: (event) => {
                    const button = event.currentTarget;
                    const ripple = document.createElement("span");
                    const diameter = Math.max(button.clientWidth, button.clientHeight);
                    const radius = diameter / 2;
                    const rect = button.getBoundingClientRect();
                    ripple.style.width = ripple.style.height = `${diameter}px`;
                    ripple.style.left = `${event.clientX - rect.left - radius}px`;
                    ripple.style.top = `${event.clientY - rect.top - radius}px`;
                    ripple.classList.add("ripple");
                    const existingRipple = button.getElementsByClassName("ripple")[0];
                    if (existingRipple) { existingRipple.remove(); }
                    button.appendChild(ripple);
                },

                createConfetti: (x, y, color) => {
                    const particleCount = 12;
                    for (let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.classList.add('particle');
                        particle.style.backgroundColor = color;
                        particle.style.left = `${x}px`;
                        particle.style.top = `${y}px`;
                        
                        const angle = Math.random() * Math.PI * 2;
                        const velocity = 50 + Math.random() * 50;
                        const tx = Math.cos(angle) * velocity;
                        const ty = Math.sin(angle) * velocity;
                        
                        particle.style.setProperty('--tx', `${tx}px`);
                        particle.style.setProperty('--ty', `${ty}px`);
                        
                        document.body.appendChild(particle);
                        setTimeout(() => particle.remove(), 800);
                    }
                },
                
                showBenefit: (key, event) => {
                    const info = state.ingredients[key];
                    const container = document.getElementById('ingredients-container');
                    const infoBox = document.getElementById('ingredient-info');
                    
                    if(info && container && infoBox) {
                        // Change Background
                        container.className = `w-full md:w-1/2 relative min-h-[450px] rounded-xl p-8 flex items-center justify-center overflow-hidden border border-gray-100 shadow-inner group transition-colors duration-700 ${info.bgColor}`;
                        
                        // Update Info
                        infoBox.innerHTML = `
                            <div class="pop-in">
                                <i class="fa-solid ${info.icon} text-4xl mb-3 ${info.color} block drop-shadow-sm"></i>
                                <h4 class="font-heading font-bold text-xl mb-2 text-brand-black">${info.title}</h4>
                                <p class="text-sm text-gray-700 font-medium">${info.desc}</p>
                            </div>
                        `;
                        
                        // Confetti Burst
                        if(event) {
                             const rect = event.currentTarget.getBoundingClientRect();
                             const centerX = rect.left + rect.width / 2 + window.scrollX;
                             const centerY = rect.top + rect.height / 2 + window.scrollY;
                             app.createConfetti(centerX, centerY, info.particleColor);
                        }
                    }
                },
                
                resetBenefit: () => {
                    const container = document.getElementById('ingredients-container');
                    const infoBox = document.getElementById('ingredient-info');
                    if(container && infoBox) {
                        // Reset Background
                        container.className = `w-full md:w-1/2 relative min-h-[450px] bg-brand-light rounded-xl p-8 flex items-center justify-center overflow-hidden border border-gray-100 shadow-inner group transition-colors duration-700`;
                        
                        // Reset Info
                        infoBox.innerHTML = `
                            <div class="animate-fade-in">
                                <h4 class="font-heading font-bold text-xl mb-3 text-brand-black">Nature's Best</h4>
                                <p class="text-sm text-gray-600 leading-relaxed">Hover over the floating ingredients to discover their skin-loving benefits.</p>
                            </div>
                        `;
                    }
                },

                setCategory: (cat) => { console.log("Single product mode active"); },

                scrollToSection: (id) => {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                },

                toggleMobileMenu: () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                },

                toggleCart: () => {
                    const overlay = document.getElementById('cart-overlay');
                    const drawer = document.getElementById('cart-drawer');
                    const body = document.body;
                    
                    if (overlay.classList.contains('hidden')) {
                        overlay.classList.remove('hidden');
                        setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                        drawer.classList.remove('translate-x-full');
                        body.classList.add('overflow-hidden');
                    } else {
                        overlay.classList.add('opacity-0');
                        drawer.classList.add('translate-x-full');
                        body.classList.remove('overflow-hidden');
                        setTimeout(() => overlay.classList.add('hidden'), 300);
                    }
                },
                
                navigate: (loc) => { window.scrollTo({ top: 0, behavior: 'smooth' }); },

                addToCart: (id) => {
                    const existing = state.cart.find(item => item.id === id);
                    if (existing) { existing.quantity++; } else { state.cart.push({ id, quantity: 1 }); }
                    updateCartUI();
                    setTimeout(() => app.toggleCart(), 300);
                },

                updateQuantity: (id, change) => {
                    const item = state.cart.find(i => i.id === id);
                    if (item) {
                        item.quantity += change;
                        if (item.quantity <= 0) { app.removeFromCart(id); } else { updateCartUI(); }
                    }
                },

                removeFromCart: (id) => {
                    state.cart = state.cart.filter(i => i.id !== id);
                    updateCartUI();
                },

                // STRIPE CHECKOUT HANDLER
                processCheckout: async () => {
                    const btn = document.getElementById('checkout-btn');
                    const originalText = btn.innerHTML;
                    
                    // 1. Basic Validation
                    if(state.cart.length === 0) {
                        alert("Your basket is empty!");
                        return;
                    }

                    // 2. Show Loading State
                    btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...`;
                    btn.disabled = true;

                    // 3. Initialize Stripe
                    // Replace 'pk_test_...' with your actual Stripe Publishable Key
                    const stripe = Stripe('pk_test_TYooMQauvdEDq54NiTphI7jx'); 

                    // 4. Prepare Line Items
                    const lineItems = state.cart.map(item => {
                        const product = state.products.find(p => p.id === item.id);
                        return {
                            price: product.stripePriceId, // Use the Price ID from your state
                            quantity: item.quantity
                        };
                    });

                    // 5. Redirect to Checkout
                    const { error } = await stripe.redirectToCheckout({
                        lineItems: lineItems,
                        mode: 'payment',
                        successUrl: window.location.href + '?success=true',
                        cancelUrl: window.location.href + '?canceled=true',
                    });

                    if (error) {
                        console.error("Stripe Error:", error);
                        alert("Payment redirection failed. Please try again.");
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                },

                // NEW: Generic Info Modal Handler
                openInfoModal: (type) => {
                    const modal = document.getElementById('product-modal');
                    const content = document.getElementById('modal-content');
                    let html = '';

                    if (type === 'shipping') {
                        html = `
                            <div class="w-full p-8 md:p-12 relative bg-white">
                                <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
                                    <i class="fa-solid fa-truck-fast text-9xl text-brand-gold"></i>
                                </div>
                                <h2 class="text-3xl font-heading font-bold mb-6 text-brand-black">Shipping & Returns</h2>
                                
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="font-bold text-lg mb-2 text-brand-gold">Shipping Policy</h3>
                                        <p class="text-gray-600 leading-relaxed">
                                            We hand-pack and ship all orders within 1-2 business days from our Texas studio. 
                                            We offer <span class="font-bold text-brand-black">free standard shipping</span> (3-5 business days) on all orders within the continental US.
                                        </p>
                                    </div>
                                    
                                    <div>
                                        <h3 class="font-bold text-lg mb-2 text-brand-gold">Return Policy</h3>
                                        <p class="text-gray-600 leading-relaxed">
                                            Due to the personal nature of our products, we cannot accept returns on used soap bars. 
                                            However, your satisfaction is our priority. If you are unsatisfied with your purchase for any reason, 
                                            please contact us within 14 days of delivery for a full refund or replacement.
                                        </p>
                                    </div>
                                </div>
                                <button onclick="app.closeModal()" class="mt-8 w-full bg-gray-100 text-brand-black py-3 font-bold tracking-widest hover:bg-gray-200 transition-colors">CLOSE</button>
                            </div>
                        `;
                    } else if (type === 'contact') {
                        html = `
                            <div class="w-full p-8 md:p-12 bg-white">
                                <h2 class="text-3xl font-heading font-bold mb-2 text-brand-black">Get in Touch</h2>
                                <p class="text-gray-600 mb-8">Have a question about our ingredients or a bulk order? Send us a note!</p>
                                
                                <form onsubmit="event.preventDefault(); alert('Message sent! We will get back to you shortly.'); app.closeModal();">
                                    <div class="mb-4">
                                        <label class="block text-xs font-bold uppercase text-brand-gold mb-2">Email Address</label>
                                        <input type="email" class="w-full bg-gray-50 border border-gray-200 p-3 rounded focus:outline-none focus:border-brand-gold" required placeholder="you@example.com">
                                    </div>
                                    <div class="mb-6">
                                        <label class="block text-xs font-bold uppercase text-brand-gold mb-2">Message</label>
                                        <textarea class="w-full bg-gray-50 border border-gray-200 p-3 rounded h-32 focus:outline-none focus:border-brand-gold" required placeholder="How can we help?"></textarea>
                                    </div>
                                    <button class="btn-ripple w-full bg-brand-black text-white py-4 font-bold tracking-widest hover:bg-brand-gold transition-colors shadow-lg" onclick="app.createRipple(event)">
                                        SEND MESSAGE
                                    </button>
                                </form>
                            </div>
                        `;
                    } else if (type === 'ingredients') {
                        html = `
                            <div class="w-full p-8 md:p-12 bg-white">
                                <h2 class="text-3xl font-heading font-bold mb-6 text-brand-black">Full Ingredients List</h2>
                                <p class="text-gray-600 mb-6">Our Texas Honey & Vanilla Oat bar is made with just five active ingredients.</p>
                                <ul class="space-y-4">
                                    <li class="flex justify-between border-b border-gray-100 pb-2">
                                        <span class="font-bold text-brand-black">Colloidal Oatmeal</span>
                                        <span class="text-gray-500 text-sm">Soothes Itching</span>
                                    </li>
                                    <li class="flex justify-between border-b border-gray-100 pb-2">
                                        <span class="font-bold text-brand-black">Raw Texas Honey</span>
                                        <span class="text-gray-500 text-sm">Humectant / Moisture</span>
                                    </li>
                                    <li class="flex justify-between border-b border-gray-100 pb-2">
                                        <span class="font-bold text-brand-black">Sweet Almond Oil</span>
                                        <span class="text-gray-500 text-sm">Vitamin E / Softening</span>
                                    </li>
                                    <li class="flex justify-between border-b border-gray-100 pb-2">
                                        <span class="font-bold text-brand-black">Vanilla Essential Oil</span>
                                        <span class="text-gray-500 text-sm">Antioxidant / Scent</span>
                                    </li>
                                    <li class="flex justify-between border-b border-gray-100 pb-2">
                                        <span class="font-bold text-brand-black">Rolled Oats</span>
                                        <span class="text-gray-500 text-sm">Physical Exfoliation</span>
                                    </li>
                                </ul>
                                <button onclick="app.closeModal()" class="mt-8 w-full bg-gray-100 text-brand-black py-3 font-bold tracking-widest hover:bg-gray-200 transition-colors">CLOSE</button>
                            </div>
                        `;
                    } else if (type === 'sustainability') {
                        html = `
                            <div class="w-full p-8 md:p-12 bg-white text-center">
                                <i class="fa-solid fa-earth-americas text-5xl text-brand-sage mb-6"></i>
                                <h2 class="text-3xl font-heading font-bold mb-4 text-brand-black">Our Promise</h2>
                                <p class="text-gray-600 leading-relaxed mb-6">
                                    We believe luxury shouldn't cost the earth. That's why EssentialSuds is committed to:
                                </p>
                                <ul class="text-left space-y-3 mb-8 bg-brand-light p-6 rounded-lg">
                                    <li class="flex items-center"><i class="fa-solid fa-check text-brand-gold mr-3"></i> 100% Plastic-Free Packaging</li>
                                    <li class="flex items-center"><i class="fa-solid fa-check text-brand-gold mr-3"></i> Sustainably Sourced Oils</li>
                                    <li class="flex items-center"><i class="fa-solid fa-check text-brand-gold mr-3"></i> Cruelty-Free & Vegan</li>
                                    <li class="flex items-center"><i class="fa-solid fa-check text-brand-gold mr-3"></i> Recycled Paper Labels</li>
                                </ul>
                                <button onclick="app.closeModal()" class="w-full bg-brand-black text-white py-3 font-bold tracking-widest hover:bg-brand-gold transition-colors">BACK TO SHOP</button>
                            </div>
                        `;
                    }

                    content.innerHTML = html;
                    modal.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');
                },

                openModal: (id) => {
                    const product = state.products.find(p => p.id === id);
                    const modal = document.getElementById('product-modal');
                    const content = document.getElementById('modal-content');

                    // MODIFIED: Logic to handle new object-based image structure
                    // If images don't exist, fallback to single image in object structure
                    let images = [];
                    if (product.images && product.images.length > 0) {
                        // Check if it's already an object or a string
                        if (typeof product.images[0] === 'string') {
                             images = product.images.map(src => ({ src, title: "View", desc: product.shortDesc }));
                        } else {
                             images = product.images;
                        }
                    } else {
                        images = [{ src: product.image, title: "Main View", desc: product.shortDesc }];
                    }

                    // Default description to first image or product short desc
                    const initialDesc = images[0].desc || product.shortDesc;

                    content.innerHTML = `
                        <div class="w-full md:w-1/2 bg-gray-100 flex flex-col">
                            <div class="h-64 md:h-96 w-full relative group">
                                 <!-- Main Image with ID for switching -->
                                 <img id="modal-main-image" src="${images[0].src}" 
                                      class="w-full h-full object-cover transition-opacity duration-300" 
                                      onerror="window.handleImageError(this)">
                                 
                                 <!-- Dynamic Caption Overlay -->
                                 <div class="absolute bottom-0 left-0 w-full bg-black/50 backdrop-blur-sm p-3 text-white text-center transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                                     <span id="modal-image-caption" class="font-heading font-bold text-sm tracking-widest uppercase">${images[0].title}</span>
                                 </div>
                            </div>
                            
                            <!-- Thumbnail Gallery -->
                            <div class="flex gap-2 p-4 overflow-x-auto bg-white border-t border-gray-100">
                                ${images.map((img, index) => `
                                    <div class="flex-shrink-0 w-20 h-20 cursor-pointer border-2 border-transparent hover:border-brand-gold rounded overflow-hidden transition-all relative group"
                                         onclick="document.getElementById('modal-main-image').src = '${img.src}'; 
                                                  document.getElementById('modal-image-caption').innerText = '${img.title}';
                                                  document.getElementById('modal-product-desc').innerText = '${img.desc || product.shortDesc}';">
                                        <img src="${img.src}" class="w-full h-full object-cover" onerror="window.handleImageError(this)">
                                        <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col">
                            <div class="mb-auto">
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block">Signature Collection</span>
                                <h2 class="text-3xl font-heading font-bold mb-2">${product.name}</h2>
                                <div class="flex items-center gap-2 mb-6">
                                    <span class="text-2xl text-brand-black font-semibold">$${product.price.toFixed(2)}</span>
                                </div>
                                <p id="modal-product-desc" class="text-gray-600 mb-8 leading-relaxed">
                                    ${initialDesc}
                                </p>
                                
                                <div class="grid grid-cols-2 gap-4 mb-8">
                                    <div class="p-4 bg-gray-50 rounded border border-gray-100">
                                        <span class="block text-xs text-gray-400 uppercase">Skin Type</span>
                                        <span class="font-bold text-brand-black">${product.skinType}</span>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded border border-gray-100">
                                        <span class="block text-xs text-gray-400 uppercase">Net Weight</span>
                                        <span class="font-bold text-brand-black">${product.weight}</span>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded border border-gray-100">
                                        <span class="block text-xs text-gray-400 uppercase">Scent Profile</span>
                                        <span class="font-bold text-brand-black">${product.scent}</span>
                                    </div>
                                </div>

                                <div class="mb-8">
                                    <h4 class="text-sm font-bold uppercase mb-2">Key Ingredients</h4>
                                    <ul class="flex flex-wrap gap-2">
                                        ${product.ingredients.map(ing => `<li class="text-xs bg-brand-cream text-brand-black px-3 py-1 rounded-full border border-brand-sage">${ing}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                            
                            <button onclick="app.createRipple(event); app.addToCart(${product.id}); app.closeModal()" class="btn-ripple w-full bg-brand-black text-white py-4 font-bold tracking-widest hover:bg-brand-gold transition-colors shadow-lg">
                                ADD TO BASKET
                            </button>
                        </div>
                    `;

                    modal.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');
                },

                closeModal: () => {
                    const modal = document.getElementById('product-modal');
                    modal.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }
            };
        })();

        // Start App on Load
        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
